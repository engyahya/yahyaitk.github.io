<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smooth Image Slider with Accumulated Results</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; display: flex; justify-content: center; flex-direction: column; align-items: center; }

    section {
      padding: 20px;
      background-color: #f9f9f9;
      text-align: center;
      max-width: 1000px; /* Limit section width */
    }

    .slider-container { position: relative; max-width: 1000px; margin: auto; }
    .slides { display: none; position: relative; }
    img { width: 100%; height: auto; }

    /* Caption container */
    .caption-container {
      background-color: #f2f2f2;
      padding: 15px;
      font-size: 16px;
      color: #333;
    }

    /* Style for the input slider */
    .slider {
      width: 50%; /* Set to 50% of the page width */
      margin: 20px auto;
      position: relative;
    }

    .slider input[type="range"] {
      width: 100%; /* Make sure the slider itself takes up full width of the slider container */
    }

    /* Style for the slider labels */
    .slider-labels {
      display: flex;
      justify-content: space-between;
      width: 50%; /* Match the width of the slider */
      margin: 10px auto 0;
      font-size: 14px;
    }

    .instructions {
      text-align: center;
      margin: 10px 0;
      font-size: 16px;
      color: #555;
    }

    .accumulate-button {
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
    }

    .accumulate-button:hover {
      background-color: #0056b3;
    }

    /* Centering the chart */
    .chart-container {
      display: flex;
      justify-content: center;
      margin-top: 20px; /* Space above the chart */
    }

    canvas {
      width: 50%; /* Take up half of the page width */
      max-width: 600px; /* Maximum width of the canvas */
      height: 300px; /* Fixed height */
    }

    /* Output coordinates */
    #output {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>
<body>

<section>
  <div class="instructions">
    Swipe the bar to explore data over time. Move left for earlier data, right for later data.
  </div>

  <div class="slider-container">
    <!-- Slide 1 -->
    <div class="slides">
      <img src="images_full_BNPI/BNPI_20220208_RUPNet_first.png" alt="Landform 1">
      <div class="caption-container">Landform 1: Data collected on January 2023</div>
    </div>

    <!-- Slide 2 -->
    <div class="slides">
      <img src="images_full_BNPI/BNPI_20220325_RUPNet_first.png" alt="Landform 2">
      <div class="caption-container">Landform 2: Data collected on February 2023</div>
    </div>

    <!-- Slide 3 -->
    <div class="slides">
      <img src="images_full_BNPI/BNPI_20231125_RUPNet_first.png" alt="Landform 3">
      <div class="caption-container">Landform 3: Data collected on March 2023</div>
    </div>

    <!-- Accumulated Results Slide -->
    <div class="slides" id="accumulatedSlide">
      <img src="images_full_BNPI/BNPI_20240129_RUPNet_blended_output.png" alt="Accumulated Results">
      <div class="caption-container">Accumulated Results: Combined data from all months</div>
    </div>
  </div>

  <!-- Range input slider for controlling the slides -->
  <div class="slider">
    <input type="range" min="1" max="100" value="1" class="slider-input" id="imageSlider" step="1">
  </div>

  <!-- Time labels for slider direction -->
  <div class="slider-labels">
    <span>Earlier</span>
    <span>Later</span>
  </div>

  <!-- Accumulate Results Button -->
  <button class="accumulate-button" id="accumulateButton">Show Accumulated Results</button>

  <!-- Output for pixel coordinates -->
  <div id="output">Selected Pixel: (X, Y)</div>

  <!-- Chart container -->
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Initial slide index and number of slides
  const totalSlides = document.getElementsByClassName("slides").length;
  let selectedX = null;
  let selectedY = null;
  let chartInstance;

  // Show the corresponding slide based on index
  function showSlides(n) {
    let slides = document.getElementsByClassName("slides");
    for (let i = 0; i < slides.length; i++) {
      slides[i].style.display = "none"; // Hide all slides
    }
    slides[n - 1].style.display = "block"; // Show the corresponding slide
  }

  // Initialize slider
  const sliderInput = document.getElementById("imageSlider");

  // Function to map slider value to slide number (e.g., slider value 1-100 mapped to totalSlides)
  function mapSliderValue(sliderValue) {
    const step = 100 / (totalSlides - 1); // Step size for each slide based on the slider's range
    return Math.ceil(sliderValue / step); // Calculate slide index based on slider value
  }

  // Event listener for when the slider is moved
  sliderInput.addEventListener("input", function() {
    const slideIndex = mapSliderValue(parseInt(sliderInput.value));
    showSlides(slideIndex);
  });

  // Show the accumulated results slide when the button is clicked
  document.getElementById("accumulateButton").addEventListener("click", function() {
    showSlides(totalSlides); // Show the last slide (accumulated results)
  });

  // Function to process selected pixel and generate the chart
  function processPixel(row, column) {
    // Replace this with your actual logic to get pixel values from a binary matrix
    // Simulating pixel data for demonstration
    const pixelValues = Array.from({ length: 100 }, () => Math.round(Math.random()));

    // Update output coordinates
    document.getElementById("output").innerText = `Selected Pixel: (${row}, ${column})`;

    // Count occurrences of ones (1s)
    const onesCount = pixelValues.reduce((a, b) => a + (b === 1 ? 1 : 0), 0); // Count of 1s

    // Chart configuration
    if (chartInstance) {
      chartInstance.destroy(); // Destroy the previous chart instance if it exists
    }

    const ctx = document.getElementById('myChart').getContext('2d');
    chartInstance = new Chart(ctx, {
      type: 'line',
      data: {
        labels: Array.from({ length: pixelValues.length }, (_, i) => i), // X-axis labels (0 to pixelValues.length)
        datasets: [{
          label: `Pixel (${row}, ${column})`,
          data: pixelValues,
          fill: false,
          borderColor: 'rgba(75, 192, 192, 1)',
          tension: 0.1
        }]
      },
      options: {
        scales: {
          x: { title: { display: true, text: 'Index' } },
          y: { title: { display: true, text: 'Count of 1s' } }
        }
      }
    });
  }

  // Add event listener to images to select pixel on click
  const slides = document.getElementsByClassName("slides");
  for (let i = 0; i < slides.length; i++) {
    slides[i].addEventListener("click", function() {
      // Update selected coordinates based on click location
      const rect = this.getElementsByTagName('img')[0].getBoundingClientRect();
      const x = Math.floor((event.clientX - rect.left) / (rect.width / 1500)); // Normalizing to 0-100 for demonstration
      const y = Math.floor((event.clientY - rect.top) / (rect.height / 100));

      selectedX = x;
      selectedY = y;

      processPixel(selectedY, selectedX); // Pass selected pixel to process function
    });
  }

  // Show the first slide initially
  showSlides(1);
</script>

</body>
</html>
